# 부트스트랩

부트스트랩은 네티로 네트워크 애플리케이션을 작성할 때 가장 기본이 된다. 네티로 작성한 네트워크 애플리케이션이 시작할 때 가장 처음 수행된다. 애플리케이션이 수행할 동작과 각종 설정을 지정해 네티 애플리케이션의 기본이 된다.

부트스트랩 설정은 크게 이벤트 루프, 채널의 전송 모드, 채널 파이프라인으로 나뉜다.
1. 이벤트 루프
   1. 소켓 채널에서 발생할 이벤트를 처리하는 스레드 모델 구현이 들어간다.
   1. 부트스트랩에 설정한 소켓 모드에 따라 사용되는 이벤트 루프의 구현체가 달라지기도 한다.
   2. 사용할 소켓 채널의 모드에 따라서 블로킹, 논블로킹 그리고 epoll로 지정할 수 있다.
   3. epoll은 입출력 다중화 기법으로 현재까지 알려진 입출력 방식 중 가장 빠르다. 하지만 리눅스에서만 동작하며 커널 버전 2.6부터 사용할 수 있다.
1. 채널 파이프라인
   1. 소켓 채널로 수신된 데이터를 처리할 데이터 핸들러들을 지정한다.

## 부트스트랩의 정의

부트스트랩은 네티로 작성한 네트워크 애플리케이션의 동작 방식과 환경을 설정하는 도우미 클래스다. 네트워크에서 수신한 데이터를 단일 스레드로 데이터베이스로 저장하는 네트워크 애플리케이션을 예를 들어보자. 8088번 포트에서 데이터를 수신하고 소켓 모드는 NIO를 사용한다. 위 요구사항에서 부트스트랩을 설정하려면 NIO 소켓 모드를 지원하는 서버 소켓 채널, 데이터를 변환하여 데이터베이스에 저장하는 데이터 처리 이벤트 핸들러, 애플리케이션이 사용할 8088번 포트 바인딩, 단일 스레드를 지원하는 이벤트 루프 설정이 필요하다.

## 부트스트랩의 구조

- 전송 계층(소켓 모드 및 I/O 종류)
- 이벤트 루프 (단일 스레드, 다중 스레드)
- 채널 파이프라인 설정
- 소켓 주소와 포트
- 소켓 옵션

웹 서버인 아파치 톰캣의 경우 XML을 사용해 톰캣 커넥터가 사용할 입출력 모드와 스레드 수 그리고 TCP 서비스 포트를 설정할 수 있다. 웹 서버이므로 HTTP 프로토콜을 사용하고 웹 서비스 관리자를 위한 계정을 설정한다. 웹 서버에 특화된 내용이 추가되었을 뿐, 네티의 부트스트랩 설정 내용과 대부분 동일하다. 참고로 프로토콜은 채널 파이프라인에 등록되는 인코더와 디코더에서 처리한다.

네티 부트스트랩은 서버 애플리케이션을 위한 `ServerBootstrap` 클래스와 클라이언트 애플리케이션을 위한 `Bootstrap` 클래스로 나뉜다. 소켓 연결을 요청하느냐 아니면 대기 하느냐에 따른 구분이다. 상대방 소켓으로 연결 요청을 시도하는 쪽이 클라이언트다. `ServerBootstrap` 클래스는 클라이언트 접속을 대기할 포트를 설정하는 메소드가 추가되었을 뿐이다. API 구조는 `Bootstrap`과 동일하다.

각 부트스트랩 클래스는 `AbstractBootstrap` 클래스와 `Channel` 인터페이스를 상속받는다. 빌더 패턴을 사용하기에 다양한 설정을 쉽게 설정할 수 있다.

## 참고 도서
자바 네트워크 소녀 네티