# Travis CI 배포 자동화

365일 24시간동안 운영해야 하는 서비스에서 배포 환경 구축은 필수 과제다. 실시간으로 코드가 병합되고 테스트가 수행되는 환경, `master` 브랜치에 푸시된 순간 배포가 자동으로 이루어지는 환경을 구축하지 않으면 실수할 여지가 많다.

## CI & CD 소개

배포할 때 늘 EC2 서버에 `./deploy.sh` 스크립트를 실행해야하는 불편함이 있었다. CI, CD 환경을 구축해 이 과정을 자동화하고자 한다.

CI(Continuous Integration - 지속적 통합)는 코드 버전 관리를 하는 VCS 시스템(Git, SVN 등)에 Push가 되면 자동으로 테스트와 빌드가 수행되어 안정적인 배포 파일을 만드는 과정이다.  
CD(Continuous Deployment - 지속적인 배포)는 CI에서 만든 빌드 결과를 자동으로 운영 서버에 무중단 배포를 진행하는 과정이다.  
일반적으로 CI만 구축되지 않고 CD도 함께 구축된다.  
CI/CD 개념은 왜 나왔을까?

하나의 프로젝트를 여러 개발자가 함께 개발을 진행한다. 각자 개발한 코드를 합쳐야 할 때 거사를 치러야 했다. 매주 병합일을 정해 각자 개발한 코드를 합치는 작업을 했다. 수작업으로 생산성이 좋을 리 없었으며 지속해서 코드가 통합되는 환경(CI)를 구축하게 됐다. 각 개발자가 원격 저장소로 푸시할 때 마다 코드를 병합하고 테스트 코드와 빌드를 수행해 자동으로 코드가 통합되어 수작업으로 코드를 합칠 필요가 없어졌다. 자연스레 개발자는 개발에만 집중할 수 있다.

CD 역시 한 두 대의 서버에 수동으로 배포작업을 할 수 있지만, 수십 또는 수백 대의 서버에 배포를 해야할 때, 긴박하게 배포 해야할 상황이 오면 수동으로 배포하기엔 무리가 크다. 이 작업 역시 자동화가 되었다.

단, CI 도구를 사용한다고 CI를 하고 있는 것은 아니다. 마틴 파울러의 CI의 네 가지 규칙이 있다.
- 모든 소스 코드가 살아 있고 누구든 현재 소스에 접근할 수 있는 단일 지점을 유지할 것
- 빌드 프로세스를 자동화해 누구든 소스로부터 시스템을 빌드하는 단일 명령어를 사용할 수 있게 할 것
- 테스팅을 자동화해 단일 명령어로 언제든지 시스템에서 건전한 테스트 수트를 실행할 수 있게 할 것
- 누구나 현재 실행 파일을 얻으면 지금까지 가장 완전한 실행 파일을 얻었다는 확신을 들게 할 것

여기서 중요한 점은 **테스팅 자동화**다. 프로젝트가 완전한 상태임을 보장하기 위해 테스트 코드가 구현되어 있어야만 한다.

# 참고도서

스프링 부트와 혼자 구현하는 웹 서비스