# 이벤트 기반 프로그래밍

이벤트 기반 프로그래밍은 전통적으로 사용자 인터페이스 포함된 프로그램에 많이 사용된다. 버튼 클릭에 반응하는 코드가 그 예다. 이벤트 먼저 정의해두고 발생한 이벤트에 따라 코드가 실행되도록 프로그램을 작성하는 것이 이벤트 기반 프로그래밍이다.

이벤트 프로그래밍에서 중요한 점은 추상화 수준이다. 추상화 수준은 이벤트를 나눌 때 어떤 크기의 단위로 나누었는지를 뜻한다. 마우스 클릭 이벤트를 예를 들면, 첫 번째로 동작을 이벤트로 변환한다. 좌측 클릭, 우측 클릭 두 이벤트로 정의할 수 있다. 두 번째는 이전보다 더 작은 단위로 나눈다. 마우스 버튼을 누르는 Click 이벤트, 눌려 있는 상태를 나타내는 Press 이벤트, 버튼에서 손을 뗄 때 Release 이벤트로 나눈다.

좌측 버튼과 우측 버튼에 적응을 한다면 6가지 이벤트로 나눈다. 6가지 이벤트를 한 번 더 추상화를 하면 버튼 이벤트는 세 가지고 좌측과 우측을 구분하는 정보를 이벤트에 전달하면 모두 정의할 수 있다.

이벤트를 고수준으로 정의하면 세부적인 제어가 힘들고, 저수준으로 정의하면 동작을 한 번 할 때 많은 이벤트가 발생해 성능에 악영향을 미친다.

UI가 포함된 앱은 사용자 수가 제한되어 있으므로 이벤트의 저수준 추상화로 인한 성능 저하는 큰 문제가 되지 않는다. 그러나 이벤트를 발생시키는 주체가 서버에 연결된 클라이언트들이라면 이벤트의 추상화를 할 때 깊게 고민해야 한다. 서버에 연결될 클라이언트의 수는 매우 가변적이고 예측이 불가능하다.

따라서 서버 관점에서의 이벤트 기반 프레임워크의 적절한 추상화 단위는 매우 중요하다.

## 이벤트 기반 네트워크 프로그래밍

먼저 이벤트를 발생하는 객체를 정의해야 한다. 이벤트가 발생할 주체를 정의하고 그 주체에서 발생될 이벤트 종류를 정의해야 한다. 네트워크 프로그램에서 이벤트가 발생하는 주체는 소켓이다. 발생하는 이벤트는 크게 소켓 연결, 데이터 송수신으로 나눈다.

소켓에 데이터를 읽고 쓰려면 소켓에 연결된 소켓 채널(NIO) 또는 스트림(Old Blocking IO, OIO)을 사용해야 한다.

만약 소켓에 문제가 발생하거나 연결된 스트림에 문제가 발생하면 어떻게 오류 처리를 해야할까? 새 소켓을 만들고 데이터를 전송하는 예외 처리 코드가 적절하게 작동해야 한다.

네티는 데이터의 읽기 쓰기를 위한 이벤트 핸들러를 지원한다. `ChannelInboundHandlerAdapter`가 그 예다. 데이터를 소켓으로 전송하기 위해 채널에 직접 기록하는 것이 아니라 데이터 핸들러를 통해 기록한다. 서버 애플리케이션의 코드를 클라이언트 애플리케이션에서 재사용하는 장점이 있다. 각 이벤트에 따라 로직을 분리하는 장점도 있다. 네티의 이벤트 핸들러는 에러 이벤트도 같이 정의한다.

# 참고 도서

자바 네트워크 소녀 네티